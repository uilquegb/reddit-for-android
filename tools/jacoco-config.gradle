apply plugin: 'jacoco'

task "jacocoTestReport"(type: JacocoReport,
        dependsOn: ["testDebugUnitTest", "connectedDebugAndroidTest"]) {


    def fileFilter = [
            '**/R.class',
            '**/R$*.class',
            '**/BuildConfig.*',
            '**/Manifest*.*',
            '**/*Test*.*',
            'android/**/*.*',
            '**/*_.class',
            '**/*_$*.class'
    ]

    def mainSrc = "${project.projectDir}/src/main/java"
    def sdkMainSrc = "$rootDir/mob-android-sdk/src/main/java"
    def classDir = fileTree(dir: "$buildDir/intermediates/classes/${android.testBuildType}", excludes: fileFilter)
    group = "reporting"
    reports { html.enabled = true }

    group = "reporting"

    reports {
        xml.enabled = true
        html.enabled = true
    }
    jacocoClasspath = configurations['androidJacocoAnt']
    sourceDirectories = files([mainSrc])
    additionalSourceDirs = files(sdkMainSrc)
    classDirectories = files([classDir])
    executionData = files(["${buildDir}/jacoco/testDebugUnitTest.exec",
                           "${buildDir}/outputs/code-coverage/connected/coverage.ec"])
}
